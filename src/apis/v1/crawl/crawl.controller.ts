const request = require('request')
const fs = require('fs')

class crawlControllers {
	public CategoryTree = async (req: any, res: any) => {
		request(
			`https://shopee.vn/api/v4/pages/get_category_tree`,
			(error: any, response: any, body: any) => {
				fs.writeFile(
					'../../data/app/category_tree.json',
					body,
					(err: any) => {
						err
							? res.json({
									mess:
										'Ghi data vô file json thất bại:' + err
							  })
							: res.json({ mess: 'Ghi data thanh công' })
					}
				)
			}
		)
	}

	public HomeCategory = async (req: any, res: any) => {
		request(
			`https://shopee.vn/api/v4/pages/get_homepage_category_list`,
			(error: any, response: any, body: any) => {
				fs.writeFile(
					'../../data/app/home_category.json',
					body,
					(err: any) => {
						err
							? res.json({
									mess:
										'Ghi data vô file json thất bại:' + err
							  })
							: res.json({ mess: 'Ghi data thanh công' })
					}
				)
			}
		)
	}

	public GetItem = async (req: any, res: any) => {
		// list code collection
		// 1237209 ,1918898, 1655298, 1123034, 1178224, 1170158, 2048012,  2040082, 2013496
		const collectionId = 1822140
		request(
			`https://shopee.vn/api/v4/collection/get_items?collection_id=${collectionId}&limit=150&show_collection_info=true&source=1`,
			(error: any, response: any, body: any) => {
				fs.writeFile(
					'../../data/item/collection9.json',
					body,
					(err: any) => {
						err
							? res.json({
									mess:
										'Ghi data vô file json thất bại:' + err
							  })
							: res.json({ mess: 'Ghi data thanh công' })
					}
				)
			}
		)
	}

	public FlashSale = async (req: any, res: any) => {
		request(
			`https://shopee.vn/api/v4/flash_sale/flash_sale_get_items?limit=300&need_personalize=true&offset=0&order_mode=1&sort_soldout=true&with_dp_items=true`,
			(error: any, response: any, body: any) => {
				fs.writeFile(
					'../../data/flashSale/flash_sale.json',
					body,
					(err: any) => {
						err
							? res.json({
									mess:
										'Ghi data vô file json thất bại:' + err
							  })
							: res.json({ mess: 'Ghi data thanh công' })
					}
				)
			}
		)
	}

	public HotItems = async (req: any, res: any) => {
		;[
			21776127672, 22032097719, 22132090546, 12898540267, 21876100508,
			22131833589, 21876008612, 22131808755, 22131788160, 17893517490,
			23231718377, 23531713742, 21475962361, 18175943933, 22431569211,
			23431561108, 23231559968, 18075927520, 22031469627, 22731464343,
			20175791174, 21775787259, 19475798458, 22731174085, 22831169201,
			20075786733, 21275777437, 21675777008, 22431152031, 22531147383,
			22431144127, 23031117280, 19875763456, 22731120089, 23431109994,
			16193449244, 23430952949, 21375705543, 19175712136, 21675699895,
			22930941324, 22430942659, 19875694584, 23930923043, 22830922926,
			22430919636, 18875706000, 22030914819, 13504714491, 6897719280,
			19275146428, 22929313543, 21075129706, 19575130409, 22729241378,
			20475102211, 22529234881, 23528827805, 22728819187, 22728769762
		].forEach((itemid, index) => {
			const limit = 100
			const shopid = 267466458
			request(
				`https://shopee.vn/api/v4/pdp/get_hot_sales?item_id=${itemid}&limit=${limit}&offset=0&shop_id=${shopid}`,
				(error: any, response: any, body: any) => {
					fs.writeFile('../data/vien.json', body, (err: any) => {
						err
							? res.json({
									mess:
										'Ghi data vô file json thất bại:' + err
							  })
							: res.json({ mess: 'Ghi data thanh công' })
					})
				}
			)
		})
	}

	public Ratings = async (req: any, res: any) => {
		for (
			let index = 0;
			index <
			require('../../../../data/flashSale/flash_sale.json')?.data?.items
				?.length;
			index++
		) {
			const { itemid, shopid } =
				require('../../../../data/flashSale/flash_sale.json')?.data
					?.items[index] || undefined
			request(
				`https://shopee.vn/api/v2/item/get_ratings?filter=0&flag=1&itemid=${itemid}&shopid=${shopid}`,
				(error: any, response: any, body: any) => {
					fs.writeFile(
						`../../data/ratings/rating_${index}.json`,
						body,
						(err: any) => {
							err
								? res.json({
										mess:
											'Ghi data vô file json thất bại:' +
											err
								  })
								: res.json({ mess: 'Ghi data thanh công' })
						}
					)
				}
			)
		}
	}

	public ShopInfo = async (req: any, res: any) => {
		;[
			267466458, 88201679, 63963995, 309549005, 31664935, 571784183,
			138324344, 351426309, 74271442, 27228264, 148827694, 558981488,
			585130624, 37639222, 296694982, 699528, 182631756, 304843861,
			38308826, 127443748, 17384408, 219490641, 114077203, 116043557,
			108156851, 48794629, 106933589, 37251933, 63524190, 458450498,
			199984838, 203741606, 111138057, 261137996, 193207976, 156517921,
			691810201, 238383015, 14195317, 9277307, 421677475, 175753395,
			831509831, 22823111, 277411443, 210104545, 457209160, 285380605,
			266629740, 379382494, 450461337, 518715302, 102366617, 58411241,
			590427230, 88052476, 329272551, 251295945, 668093957, 193849872,
			108276104, 232843748, 106909158, 233692311, 403613154, 134371556,
			494676223, 44806875, 158647903, 408810138, 8778931, 56083716,
			199163928, 151657812, 853507050, 412741369, 307134526, 17626336,
			540766923, 27495213, 58535650, 204172029, 19445085, 979943,
			358791125, 380004811, 641644113, 772885806, 511327606, 37252407,
			618243654, 118938080, 37251700, 18363975, 147191228, 52926689,
			546030135, 601250725, 468195803, 61891690, 231547049, 836992047,
			212004800, 293349041, 80861283, 33410551, 516321004, 409389656,
			74224928, 151598291, 77269044, 182549544, 65930452, 243563394,
			89960894, 432850658, 400661905, 199528344, 340959280, 38156246,
			323127480, 244551815, 148910286, 827650386, 21736126, 450254737,
			639703167, 362647075, 806561057, 156771885, 775896364, 292075878,
			224785554, 186168987, 76329108, 38129983, 286107128, 44447389,
			750772418, 805909778, 101633362, 126877539, 19958411, 361993244,
			341325550, 411071213, 340921872, 60596463, 192758503, 840666972,
			243936907, 241728979, 60964287, 297744732, 592325853, 317283087,
			287175989, 181877747, 13694429, 399391900, 837033116, 724647646,
			361217864, 865717263, 186680691, 251112545, 864631463, 758541893,
			13402666, 329574230, 63237126, 308440249, 82702285, 327887078,
			82095709, 312803513, 182330622, 805963190, 45402331, 287103756,
			87211253, 275242476, 501163039, 99553806, 234853116, 82364307,
			634792583, 563637339, 16511872, 447561333, 83766754, 415853916,
			426964114, 448790585, 156707818, 277259317, 241827085, 37101020,
			82924693, 345875119, 293862608, 215043735, 752295964, 468849027,
			697821129, 562665255, 170155521, 156981069, 162631527, 313173734,
			194126412, 99441940, 816490879, 157716753, 455557468, 820451097,
			611883661, 193918583, 887954000, 29536398, 783311778, 51809524,
			26947756, 393363854, 38038824, 273634451, 130961937, 131195741,
			166333877, 304914610, 239356383, 132894999, 33522349, 35211675,
			253598734, 297412293, 345248715, 421820928, 88342813, 317428602,
			26274679, 451812585, 107693088, 720163788, 805940670, 127805122,
			68527388, 76219330, 35080757, 92564297, 581254417, 839188640,
			627326399, 130938115, 64128837, 419385393, 292893291, 705427866,
			453043569, 65589552, 95303264, 278908410, 507871359, 201171779,
			90428978, 45194730, 340382054, 211267721, 584209438, 747456187,
			278100765, 360585330, 73512480, 619025900, 382964977, 179124960,
			416042653, 443462019, 42063380, 458675969, 96527712, 79343664,
			45702547, 108341566, 399007195, 768258384, 473310406, 703899271,
			201774917, 69896757, 415422361, 639673459, 85648300, 492542376,
			585510534, 816261176, 81155644, 619022569, 26310290, 174605355,
			366976836, 40342563, 327983642, 448787450, 448907161, 147229880,
			21120437, 319625063, 53903269, 58542133, 415259520, 47189272,
			510213755, 469754075, 164018338, 221366989, 653870673, 94123517,
			341501147, 9770997, 51646476, 254624743, 517382923, 17271526,
			16580423, 456140504, 440232497, 257372007, 95564980, 161242501,
			394937840, 267737756, 49755456, 468870617, 149572979, 619355163,
			464080933, 455540543, 23793258, 315998806, 774947640, 289950812,
			441821365, 93936823, 188032506, 469093559, 344790312, 406630909,
			513205325, 343517244, 463626782, 190764922, 1850970, 773834523,
			254666730, 599663693, 597699842, 285871285, 623909940, 14988194,
			296222308, 102041787, 714549863, 567557069, 164964754, 326186750,
			78502039, 18183995, 749566899, 15389347, 326575253, 148915004,
			52679373, 799912301, 100256821, 377401371, 116850257, 126589972,
			315066846, 24625047, 316170416, 288278331, 236911950, 359322451,
			55771655, 268182642, 98153208, 218993976, 107559320, 619003211,
			211058136, 476719941, 264111735, 235353359, 369729853, 211133030,
			768354594, 172168844, 116594764, 142005723, 768291768, 378820744,
			801304578, 394941304, 557670769, 118162294, 277274640, 16461019,
			497364265, 565106793, 159527404, 74882429, 528571633, 325696535,
			742770593, 469040198, 412295728, 233153238, 351846977, 479388424,
			226704762, 90037621, 73081114, 230763206, 136157883, 502211963,
			49405487, 230612250, 437337455, 705124494, 308784309, 400453912,
			258602683, 733752656, 738820284, 15513656, 204584343, 431801308,
			795927225, 381312820, 414298369, 1442969, 175093371, 11280435,
			70619519, 43324505, 39771488, 23703836, 35501371, 77384442,
			53498006, 83196876, 480932383, 713964395, 64493273, 14687178,
			251225496, 3352770, 339453705, 64651615, 56032444, 167697071,
			106493009, 68949821, 41607767, 126837, 17352812, 75121918, 26538542,
			70034425, 579387360, 184412876, 646951746, 19776777, 155293091,
			215167381, 275430521, 55824787, 740764794, 188678269, 699126686,
			495483680, 539422669, 680249143, 307431877, 372887921, 494109783,
			15569094, 769085, 53535392, 190416999, 152039387, 149778584,
			440983408, 19263054, 18702973, 234331032, 42892452, 78593244,
			59755980, 113559496, 374851866, 391756, 290728814, 290728455,
			10072974, 348631785, 1367793, 231361815, 141053136, 278731265,
			231595089, 344558947, 280494219, 111079612, 62542713, 261662303,
			595243828, 702803616, 27577057, 80267699, 67957871, 47855259,
			89827191, 3860514, 465458334, 7669738, 494267954, 264378684,
			631931159, 10452363, 10323148, 12044069, 11526298, 303761029,
			392874003, 4825296, 240056566, 9433897, 355181364, 587206920,
			19636273, 31267939, 43412898, 485860007, 393023478, 405447091,
			27337338, 727435818, 174563514, 42987330, 374546427, 173513432,
			85315428, 135057787, 345979601, 300348719, 19202634, 48700168,
			269609189, 296778982, 2282135, 11476636, 242644740, 30475204,
			181453621, 292368153, 23965362, 615760073, 204799675, 44661582,
			95671856, 297942706, 198616411, 74670232, 140250984, 65124036,
			94809189, 184925472, 258478671, 191413671, 48702013, 235609019,
			14070212, 213332380, 104828612, 273650958, 43899401, 25905348,
			267311302, 79220647, 58196362, 151090143, 9359688, 774361797,
			54984608, 81405451, 481644692, 472403365, 134077633, 149190882,
			608082883, 420972546, 40823219, 235623639, 9956838, 45146706,
			20794772, 52686604, 17903150, 30340700, 55199834, 19811952,
			13501868, 2661021, 47462746, 59602068, 19286576, 116335515,
			20097614, 319175938, 298458622, 7856864, 99764658, 392399858,
			168190429, 26460606, 215436120, 469648749, 290371195, 2030295,
			194097580, 9856136, 285400998, 174555522, 27368383, 9701696,
			19392360, 132482029, 176380499, 32469688, 140094218, 173083569,
			705178, 43086726, 234950298, 12964260, 171163961, 392485882,
			397164245, 25830243, 16175915, 18600360, 275899480, 266031241,
			161421050, 259496548, 8281818, 83432445, 258374317, 366729399,
			98886962, 18644537, 23272936, 202289734, 45362764, 81184070,
			174335716, 43978717, 43141470, 98758274, 346221865, 60833509,
			181585286, 181520621, 82320578, 125490645, 332985043, 16681316,
			244127547, 10133473, 65851647, 124409542, 317477677, 84884531,
			88822105, 26546582, 688513864, 319657349, 63423519, 204439869,
			279078111, 27768358, 16444874, 181790483, 35798817, 183463875,
			13350150, 324572290, 22458198, 503004616, 432328597, 28321649,
			95966193, 143402140, 298937334, 161677294, 10362464, 417241850,
			133725512, 57599990, 283396972, 537893863, 39566346, 294030011
		].forEach((shopid, index) => {
			request(
				`https://shopee.vn/api/v4/product/get_shop_info?shopid=${shopid}`,
				(error: any, response: any, body: any) => {
					fs.writeFile(
						`../../data/shop/shopInfo_${index}.json`,
						body,
						(err: any) => {
							err
								? res.json({
										mess:
											'Ghi data vô file json thất bại:' +
											err
								  })
								: res.json({ mess: 'Ghi data thanh công' })
						}
					)
				}
			)
		})
	}

	public ShopDetail = async (req: any, res: any) => {
		for (let index = 0; index < 1000; index++) {
			const userName = require(`../data/shop/shopInfo_${index}.json`).data
				.account.username
			request(
				`https://shopee.vn/api/v4/shop/get_shop_detail?&username=${userName}&fbclid=IwAR0c-vICsNCDIzP12vPlW3uUEANt-kua6ocxXcnFmdeNODcVDdU36B8uDxc`,
				(error: any, response: any, body: any) => {
					fs.writeFile(
						`../../data/shopDetail/shopDetail_${index}.json`,
						body,
						(err: any) => {
							err
								? res.json({
										mess:
											'Ghi data vô file json thất bại:' +
											err
								  })
								: res.json({ mess: 'Ghi data thanh công' })
						}
					)
				}
			)
		}
	}

	public ShopMall = async (req: any, res: any) => {
		request(
			`https://shopee.vn/api/v4/homepage/mall_shops?limit=100`,
			(error: any, response: any, body: any) => {
				fs.writeFile(`../data/shopMall.json`, body, (err: any) => {
					err
						? res.json({
								mess: 'Ghi data vô file json thất bại:' + err
						  })
						: res.json({ mess: 'Ghi data thanh công' })
				})
			}
		)
	}

	public CATE = async (req: any, res: any) => {
		for (let page = 1; page <= 15; page++) {
			request(
				`https://banhang.shopee.vn/help/api/v3/global_category/list/?page=${page}&size=100`,
				(error: any, response: any, body: any) => {
					fs.writeFile(
						`../../data/cate2/cate_${page}.json`,
						body,
						(err: any) => {
							err
								? res.json({
										mess:
											'Ghi data vô file json thất bại:' +
											err
								  })
								: res.json({ mess: 'Ghi data thanh công' })
						}
					)
				}
			)
		}
	}
}

export default new crawlControllers()
